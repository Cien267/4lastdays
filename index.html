<!doctype html>
<html lang="vi">
  <head>
    <meta charset="UTF-8" />
    <title>Work Time Tracker</title>
    <script src="https://cdn.tailwindcss.com"></script>
  </head>

  <body
    class="bg-slate-900 text-slate-100 min-h-screen flex items-center justify-center p-6"
  >
    <div class="w-full max-w-4xl space-y-6">
      <!-- Header -->
      <div class="text-center">
        <h1 class="text-3xl font-bold">‚è± Work Time Tracker</h1>
        <p class="text-slate-400 mt-1">
          M·ª•c ti√™u: 8 gi·ªù/ng√†y ¬∑ 4 ng√†y li√™n t·ª•c
        </p>
      </div>

      <!-- Overall Progress -->
      <div class="bg-slate-800 rounded-xl p-5 shadow">
        <div class="flex justify-between mb-2">
          <span class="font-semibold">T·ªïng ti·∫øn ƒë·ªô (32 gi·ªù)</span>
          <span id="totalText" class="text-sm text-slate-300"></span>
        </div>
        <div class="w-full bg-slate-700 rounded-full h-4">
          <div
            id="totalBar"
            class="bg-emerald-500 h-4 rounded-full transition-all"
          ></div>
        </div>
      </div>

      <!-- Input -->
      <div class="bg-slate-800 rounded-xl p-5 shadow space-y-4">
        <div class="grid grid-cols-1 md:grid-cols-4 gap-3">
          <input
            id="minutesInput"
            type="number"
            min="0"
            placeholder="Ph√∫t"
            class="rounded-lg bg-slate-700 px-3 py-2 focus:outline-none"
          />

          <input
            id="hoursInput"
            type="number"
            min="0"
            step="0.1"
            placeholder="Gi·ªù"
            class="rounded-lg bg-slate-700 px-3 py-2 focus:outline-none"
          />

          <select
            id="daySelect"
            class="rounded-lg bg-slate-700 px-3 py-2 focus:outline-none"
          ></select>

          <button
            onclick="addTime()"
            class="bg-emerald-500 hover:bg-emerald-400 text-slate-900 font-semibold rounded-lg px-4"
          >
            ‚ûï Add time
          </button>
        </div>
        <p class="text-sm text-slate-400">
          * C√≥ th·ªÉ nh·∫≠p ph√∫t <b>ho·∫∑c</b> gi·ªù (ho·∫∑c c·∫£ hai)
        </p>
      </div>

      <!-- Days -->
      <div
        id="daysContainer"
        class="grid grid-cols-1 md:grid-cols-2 gap-4"
      ></div>

      <!-- Stopwatch -->
      <div class="bg-slate-800 rounded-xl p-5 shadow space-y-4">
        <div class="text-center">
          <h2 class="text-xl font-semibold">‚è± Stopwatch</h2>
          <p class="text-slate-400 text-sm">
            ƒê·ªìng h·ªì b·∫•m gi·ªù ƒë·ªôc l·∫≠p (kh√¥ng t·ª± c·ªông ti·∫øn ƒë·ªô)
          </p>
        </div>

        <div
          id="stopwatchDisplay"
          class="text-center text-5xl font-mono tracking-wider"
        >
          00:00:00
        </div>

        <div class="flex justify-center gap-3">
          <button
            onclick="startStopwatch()"
            class="bg-emerald-500 hover:bg-emerald-400 text-slate-900 font-semibold px-4 py-2 rounded-lg"
          >
            ‚ñ∂ Start
          </button>

          <button
            onclick="pauseStopwatch()"
            class="bg-amber-400 hover:bg-amber-300 text-slate-900 font-semibold px-4 py-2 rounded-lg"
          >
            ‚è∏ Pause
          </button>

          <button
            onclick="stopStopwatch()"
            class="bg-sky-500 hover:bg-sky-400 text-slate-900 font-semibold px-4 py-2 rounded-lg"
          >
            ‚èπ Stop
          </button>

          <button
            onclick="resetStopwatch()"
            class="bg-rose-500 hover:bg-rose-400 text-slate-900 font-semibold px-4 py-2 rounded-lg"
          >
            üîÑ Reset
          </button>
        </div>
        <button
          onclick="copyStopwatchToMinutes()"
          class="bg-indigo-400 hover:bg-indigo-300 text-slate-900 font-semibold px-4 py-2 rounded-lg"
        >
          üìã Copy ‚Üí Minutes
        </button>
      </div>
    </div>

    <script>
      const DAILY_TARGET = 480 // minutes
      const DAYS = 4
      const STORAGE_KEY = "work-tracker"

      function formatDateLocal(date) {
        const y = date.getFullYear()
        const m = String(date.getMonth() + 1).padStart(2, "0")
        const d = String(date.getDate()).padStart(2, "0")
        return `${y}-${m}-${d}`
      }

      const startDate = new Date()
      startDate.setHours(0, 0, 0, 0)

      let data = JSON.parse(localStorage.getItem(STORAGE_KEY)) || {}

      function initDays() {
        const container = document.getElementById("daysContainer")
        const select = document.getElementById("daySelect")

        for (let i = 0; i < DAYS; i++) {
          const d = new Date(startDate)
          d.setDate(startDate.getDate() + i)
          const key = formatDateLocal(d)

          if (!data[key]) data[key] = 0

          // select
          const opt = document.createElement("option")
          opt.value = key
          opt.textContent = `Day ${i + 1} ¬∑ ${key}`
          select.appendChild(opt)

          // card
          const card = document.createElement("div")
          card.className = "bg-slate-800 rounded-xl p-5 shadow space-y-2"
          card.id = `card-${key}`

          card.innerHTML = `
            <div class="flex justify-between">
              <span class="font-semibold">Day ${i + 1}</span>
              <span id="text-${key}" class="text-sm text-slate-300"></span>
            </div>
            <div class="w-full bg-slate-700 rounded-full h-3">
              <div id="bar-${key}" class="bg-sky-500 h-3 rounded-full transition-all"></div>
            </div>
          `

          container.appendChild(card)
        }

        updateUI()
      }

      function addTime() {
        const minutes = parseInt(minutesInput.value || 0)
        const hours = parseFloat(hoursInput.value || 0)
        const day = daySelect.value

        const totalMinutes = minutes + hours * 60
        if (totalMinutes <= 0) return

        data[day] += totalMinutes
        localStorage.setItem(STORAGE_KEY, JSON.stringify(data))

        minutesInput.value = ""
        hoursInput.value = ""

        updateUI()
      }

      function updateUI() {
        let total = 0

        Object.keys(data).forEach((key) => {
          const worked = data[key]
          total += worked

          const percent = Math.min((worked / DAILY_TARGET) * 100, 100)

          document.getElementById(`bar-${key}`).style.width = percent + "%"
          document.getElementById(`text-${key}`).textContent =
            `${(worked / 60).toFixed(2)} / 8 gi·ªù`
        })

        const totalPercent = Math.min(
          (total / (DAILY_TARGET * DAYS)) * 100,
          100,
        )
        totalBar.style.width = totalPercent + "%"
        totalText.textContent = `${(total / 60).toFixed(2)} / 32 gi·ªù`
      }

      initDays()

      /* ======================
         STOPWATCH (INDEPENDENT)
      ====================== */

      let stopwatchInterval = null
      let stopwatchStartTime = null
      let elapsedTime = 0 // ms
      let isRunning = false

      function formatTime(ms) {
        const totalSeconds = Math.floor(ms / 1000)
        const hours = Math.floor(totalSeconds / 3600)
        const minutes = Math.floor((totalSeconds % 3600) / 60)
        const seconds = totalSeconds % 60

        return [
          String(hours).padStart(2, "0"),
          String(minutes).padStart(2, "0"),
          String(seconds).padStart(2, "0"),
        ].join(":")
      }

      function updateStopwatchDisplay() {
        stopwatchDisplay.textContent = formatTime(elapsedTime)
      }

      function startStopwatch() {
        if (isRunning) return

        isRunning = true
        stopwatchStartTime = Date.now() - elapsedTime

        stopwatchInterval = setInterval(() => {
          elapsedTime = Date.now() - stopwatchStartTime
          updateStopwatchDisplay()
        }, 200)
      }

      function pauseStopwatch() {
        if (!isRunning) return

        isRunning = false
        clearInterval(stopwatchInterval)
      }

      function stopStopwatch() {
        if (!isRunning) return

        isRunning = false
        clearInterval(stopwatchInterval)
        updateStopwatchDisplay()
      }

      function resetStopwatch() {
        isRunning = false
        clearInterval(stopwatchInterval)
        elapsedTime = 0
        updateStopwatchDisplay()
      }

      function copyStopwatchToMinutes() {
        const minutes = Math.floor(elapsedTime / 60000)

        if (minutes <= 0) return

        minutesInput.value = minutes
        hoursInput.value = ""

        // UX nh·ªè nh∆∞ng r·∫•t ‚Äúƒë√£‚Äù
        minutesInput.focus()
      }
    </script>
  </body>
</html>
